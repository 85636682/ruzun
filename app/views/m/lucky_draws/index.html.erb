<%= wechat_config_js debug: true, api: %w(onMenuShareTimeline) -%>
<script type="application/javascript">
  wx.ready(function() {
    wx.onMenuShareTimeline({
      title: '', // 分享标题
      link: '', // 分享链接
      imgUrl: '', // 分享图标
      success: function () {
        // 用户确认分享后执行的回调函数
      },
      cancel: function () {
        alert('哭了...');
        // 用户取消分享后执行的回调函数
      }
    });
  });
</script>
<div class="mdui-container-fluid open-body">
  <div class="mdui-row">
    <div class="mdui-col-xs-12">
      <div class="bg rotate"></div>
      <div class="open-has " style="margin-top: 50px;">
        <div class="mod-chest">
          <div class="chest-close show ">
            <div class="gift"></div>
            <div class="tips">
              <i class="arrow"></i>
            </div>
          </div>
          <div class="chest-open ">
            <div class="mod-chest-cont open-cont">
              <div class="content">
                <div class="gift">
                  <div class="icon">
                    <%= image_tag("draw/chest-icon-zuan.png") %>
                  </div>
                    x 500 
                </div>
                <div class="func">
                  <button class="mdui-btn mdui-btn-block mdui-color-red-accent mdui-ripple">查看详情并提取</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mdui-chip mdui-center" style="margin-top: -150px;margin-bottom: 20px;">
        <span class="mdui-chip-icon mdui-color-blue"><i class="mdui-icon material-icons">&#xe87c;</i></span>
        <span class="mdui-chip-title">你还有<%= current_user.lucky_draws.count %>抽奖机会</span>
      </div>
      <div class="mdui-row">
        <div class="mdui-col-xs-12">
          <button class="mdui-btn mdui-btn-block mdui-color-red-accent mdui-ripple">查看中奖详情</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(".chest-close").click(function(){

    $(this).addClass("shake");
    var that=this;
    
    this.addEventListener("webkitAnimationEnd", function(){
      
      $(that).closest(".open-has").addClass("opened");
      setTimeout(function(){
        $(that).removeClass("show");
        $(that).closest(".mod-chest").find(".chest-open").addClass("show");
        setTimeout(function(){
          $(".chest-open").addClass("blur");
        },500)
      },200)
    }, false);
  })
</script>